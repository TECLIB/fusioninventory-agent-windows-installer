version: '{branch}-build-{build}'

shallow_clone: true

notifications:
  - provider: Webhook
    url: https://hooks.aethonan.pro/appveyor/-1001137546384/
    on_build_success: true
    on_build_failure: true
    on_build_status_changed: true

install:
  - cd Perl\Scripts
  - .\install-gnu-utilities-collection.bat
  - .\install-strawberry-perl.bat
  - .\install-perl-modules-and-dependencies.bat
  - .\delete-perl-modules-and-dependencies-temporary-files.bat
  - cd ..\..

test: off

build_script:
  - cd Perl\Scripts
  - .\build-strawberry-perl-package-for-fusioninventory-agent.bat
  - cd ..\..
  - dir Perl\Strawberry

artifacts:
  - path: NSIS/*.txt,Perl/Scripts/*.log
    name: logs
  - path: Perl/Strawberry/*.xz
    name: archives
  - path: Perl/Strawberry/*.xz.md5,Perl/Strawberry/*.xz.sha1,Perl/Strawberry/*.xz.sha256
    name: digests

deploy:
  description: 'Perl for FusionInventory Agent release candidate by Teclib'
  provider: GitHub
  auth_token:
    secure: YBbTdTUzqgeUZl4OJKHvP0TFOtBR+omjfsUcxgf92+ht/4jCqCDbd/rbaswueKTe
  artifact: archives,digests
  draft: false
  prerelease: true
  on:
    appveyor_repo_tag: true
